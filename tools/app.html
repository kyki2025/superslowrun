<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…æ…¢è·‘åŠ©æ‰‹ - ä¸“ä¸šèŠ‚æ‹å™¨ã€æ™ºèƒ½è®¡æ—¶å™¨ã€è®­ç»ƒè®°å½•å·¥å…·</title>
    <meta name="description" content="ä¸“ä¸šçš„è¶…æ…¢è·‘è®­ç»ƒåŠ©æ‰‹ï¼ŒåŒ…å«ç²¾å‡†èŠ‚æ‹å™¨(170-190 BPM)ã€æ™ºèƒ½è®¡æ—¶å™¨ã€è¿åŠ¨æ•°æ®è®°å½•ã€‚ç§‘å­¦æ§åˆ¶æ­¥é¢‘ï¼Œæå‡è®­ç»ƒæ•ˆæœï¼Œé€‚åˆæ‰€æœ‰è¶…æ…¢è·‘çˆ±å¥½è€…ã€‚">
    <meta name="keywords" content="è¶…æ…¢è·‘åŠ©æ‰‹,èŠ‚æ‹å™¨,BPMæ§åˆ¶,æ­¥é¢‘è®­ç»ƒ,æ™ºèƒ½è®¡æ—¶,è¿åŠ¨è®°å½•,è¶…æ…¢è·‘å·¥å…·,ç§‘å­¦è·‘æ­¥">
    <meta name="robots" content="index,follow">
    <meta name="author" content="è¶…æ…¢è·‘å›¢é˜Ÿ">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://superslow.run/tools/app.html" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://superslow.run/tools/app.html" />
    <meta property="og:title" content="è¶…æ…¢è·‘åŠ©æ‰‹ - ä¸“ä¸šèŠ‚æ‹å™¨è®­ç»ƒå·¥å…·" />
    <meta property="og:description" content="ä¸“ä¸šçš„è¶…æ…¢è·‘è®­ç»ƒåŠ©æ‰‹ï¼Œç²¾å‡†èŠ‚æ‹å™¨ã€æ™ºèƒ½è®¡æ—¶å™¨ã€è¿åŠ¨æ•°æ®è®°å½•ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚" />
    <meta property="og:image" content="https://superslow.run/images/app-preview.png" />
    <meta property="og:site_name" content="è¶…æ…¢è·‘" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="è¶…æ…¢è·‘åŠ©æ‰‹ - ä¸“ä¸šèŠ‚æ‹å™¨è®­ç»ƒå·¥å…·" />
    <meta name="twitter:description" content="ç²¾å‡†BPMæ§åˆ¶ï¼Œæ™ºèƒ½è®¡æ—¶è®°å½•ï¼Œç§‘å­¦è¶…æ…¢è·‘è®­ç»ƒåŠ©æ‰‹ã€‚" />
    <meta name="twitter:image" content="https://superslow.run/images/app-preview.png" />
    
    <!-- Breadcrumb Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "é¦–é¡µ",
        "item": "https://superslow.run/"
      },{
        "@type": "ListItem",
        "position": 2,
        "name": "å·¥å…·",
        "item": "https://superslow.run/#tools"
      },{
        "@type": "ListItem",
        "position": 3,
        "name": "è¶…æ…¢è·‘åŠ©æ‰‹",
        "item": "https://superslow.run/tools/app.html"
      }]
    }
    </script>
    
    <!-- Software Application Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "è¶…æ…¢è·‘åŠ©æ‰‹",
      "description": "ä¸“ä¸šçš„è¶…æ…¢è·‘è®­ç»ƒå·¥å…·ï¼ŒåŒ…å«ç²¾å‡†èŠ‚æ‹å™¨ã€æ™ºèƒ½è®¡æ—¶å™¨å’Œè¿åŠ¨æ•°æ®è®°å½•åŠŸèƒ½",
      "url": "https://superslow.run/tools/app.html",
      "applicationCategory": "HealthApplication",
      "operatingSystem": "Web",
      "browserRequirements": "æ”¯æŒç°ä»£æµè§ˆå™¨",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "CNY",
        "availability": "https://schema.org/InStock"
      },
      "featureList": [
        "ç²¾å‡†èŠ‚æ‹å™¨ (100-300 BPM)",
        "æ™ºèƒ½è¿åŠ¨è®¡æ—¶",
        "è¿åŠ¨æ•°æ®è®°å½•",
        "å¤šç§éŸ³æ•ˆé€‰æ‹©",
        "è®­ç»ƒç»Ÿè®¡åˆ†æ"
      ],
      "creator": {
        "@type": "Organization",
        "name": "è¶…æ…¢è·‘å›¢é˜Ÿ",
        "url": "https://superslow.run/"
      }
    }
    </script>
    
    <link rel="stylesheet" href="../styles/app.css">
</head>
<body>
    <div class="app-container">
        <!-- å¤´éƒ¨åŒºåŸŸ -->
        <div class="app-header">
            <div class="app-logo">
                <div class="logo-icon">â™ª</div>
            </div>
            <h1 class="app-title">è¶…æ…¢è·‘åŠ©æ‰‹</h1>
            <p class="app-subtitle">ç§‘å­¦èŠ‚å¥ï¼Œæ™ºèƒ½è·‘æ­¥</p>
        </div>

        <!-- æ­¥é¢‘æ§åˆ¶æ¨¡å— -->
        <div class="bpm-module">
            <div class="card-header">
                <span class="card-icon">âš¡</span>
                <span class="card-title">æ­¥é¢‘æ§åˆ¶</span>
            </div>
            <div class="bpm-display-large">
                <button class="bpm-btn-large decrease" id="bpm-decrease">âˆ’</button>
                <div class="bpm-center">
                    <input type="text" class="bpm-value-large" id="bpm-input" value="190" readonly>
                    <div class="bpm-label">æ­¥/åˆ†é’Ÿ</div>
                    <div class="bpm-range">èŒƒå›´: 100-300</div>
                </div>
                <button class="bpm-btn-large increase" id="bpm-increase">+</button>
            </div>
            
            <div class="presets-section">
                <h3 class="section-title">å¿«é€Ÿè®¾ç½®</h3>
                <div class="preset-grid">
                    <button class="preset-item" data-bpm="170">170</button>
                    <button class="preset-item" data-bpm="180">180</button>
                    <button class="preset-item active" data-bpm="190">190</button>
                </div>
            </div>
            
            <div class="recommendation-tip">
                <div class="tip-header">
                    <span class="check-icon">âœ“</span>
                    <span class="tip-title">æ¨èèŒƒå›´</span>
                </div>
                <p class="tip-desc">è¶…æ…¢è·‘æœ€ä½³èŠ‚å¥ (170-190 æ­¥/åˆ†é’Ÿ)</p>
            </div>
        </div>

        <!-- èŠ‚æ‹å™¨å¡ç‰‡ -->
        <div class="module-card">
            <div class="card-header">
                <span class="card-icon">ğŸµ</span>
                <span class="card-title">èŠ‚æ‹å™¨</span>
            </div>
            <div class="metronome-section">
                <div class="metronome-display">
                    <div class="metronome-circle" id="metronome-circle">
                        <div class="metronome-dot"></div>
                    </div>
                    <div class="metronome-info">
                        <div class="metronome-bpm" id="metronome-bpm">190</div>
                        <div class="metronome-unit">BPM</div>
                        <div class="status-badges">
                            <span class="badge gray" id="metronome-state-badge">å·²åœæ­¢</span>
                            <span class="badge purple" id="current-sound-badge">å½“å‰: æ»´ç­”</span>
                        </div>
                    </div>
                </div>
                <button class="play-button" id="metronome-toggle">
                    <span class="play-icon">â–¶</span>
                </button>
                <div class="volume-section">
                    <div class="volume-control">
                        <span class="volume-icon">ğŸ”Š</span>
                        <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="65">
                        <span class="volume-percent" id="volume-percent">65%</span>
                    </div>
                    <div class="volume-level" id="volume-level-text">ä¸­éŸ³é‡</div>
                </div>
                <div class="sound-selector">
                    <span class="selector-label">èŠ‚æ‹éŸ³æ•ˆ</span>
                    <div class="sound-buttons">
                        <button class="sound-btn" data-sound="beep">å“”å£°</button>
                        <button class="sound-btn" data-sound="tick">å’”å—’</button>
                        <button class="sound-btn active" data-sound="click">æ»´ç­”</button>
                        <button class="sound-btn" data-sound="drum">æœ¨é±¼</button>
                        <button class="sound-btn" data-sound="bell">é“ƒå£°</button>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-title">ä½¿ç”¨æç¤º</div>
                    <div class="tips-text">ç‚¹å‡»ç»¿è‰²ç®­å¤´è¯•å¬éŸ³æ•ˆï¼ˆ2ç§’ï¼‰ å¯åŠ¨è·‘æ­¥æ—¶ä¼šè‡ªåŠ¨å¯åŠ¨èŠ‚æ‹å™¨</div>
                    <div class="tips-ok">è·‘æ­¥è¿‡ç¨‹ä¸­å¯å®æ—¶åˆ‡æ¢éŸ³æ•ˆ</div>
                </div>
            </div>
        </div>

        <!-- è·‘æ­¥è®¡æ—¶å™¨å¡ç‰‡ -->
        <div class="module-card">
            <div class="card-header">
                <span class="card-icon">â°</span>
                <span class="card-title">è·‘æ­¥è®¡æ—¶å™¨</span>
            </div>
            <div class="timer-section">
                <div class="timer-presets">
                    <span class="presets-label">é€‰æ‹©è·‘æ­¥æ—¶é—´</span>
                    <div class="preset-time-buttons">
                        <button class="time-btn" data-time="15">15åˆ†é’Ÿ</button>
                        <button class="time-btn" data-time="30">30åˆ†é’Ÿ</button>
                        <button class="time-btn" data-time="45">45åˆ†é’Ÿ</button>
                        <button class="time-btn" data-time="60">60åˆ†é’Ÿ</button>
                        <button class="time-btn" data-time="90">90åˆ†é’Ÿ</button>
                        <button class="time-btn" data-time="120">120åˆ†é’Ÿ</button>
                    </div>
                </div>
                <div class="custom-time">
                    <label class="custom-label">è‡ªå®šä¹‰æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                    <input type="number" id="custom-minutes" placeholder="15" min="1" max="999" value="15">
                    <div class="current-setting">å½“å‰è®¾å®šï¼š<span id="current-duration-label">15åˆ†é’Ÿ</span></div>
                </div>
                <button class="start-button" id="start-exercise">
                    <span class="start-icon">â–¶</span>
                    <span class="start-text">å¼€å§‹è·‘æ­¥</span>
                </button>
                <div class="tips-box">
                    <div class="tips-title">ä½¿ç”¨æç¤º</div>
                    <div class="tips-text">ç‚¹å‡»â€œå¼€å§‹è·‘æ­¥â€ä¼šå…ˆè¿›è¡Œ3ç§’å€’è®¡æ—¶ å€’è®¡æ—¶ç»“æŸåä¼šåŒæ­¥å¯åŠ¨è®¡æ—¶å™¨å’ŒèŠ‚æ‹å™¨</div>
                    <div class="tips-ok">è‡ªå®šä¹‰è¾“å…¥æ¡†æ”¯æŒæ¸…ç©ºåé‡æ–°è¾“å…¥</div>
                </div>
            </div>
        </div>

        <!-- è¿åŠ¨ç»Ÿè®¡å¡ç‰‡ -->
        <div class="module-card">
            <div class="card-header">
                <span class="card-icon">ğŸ“Š</span>
                <span class="card-title">è¿åŠ¨ç»Ÿè®¡</span>
            </div>
            <div class="stats-section">
                <div class="session-card">
                    <div class="session-left">
                        <div class="session-title">æœ¬æ¬¡è¿åŠ¨</div>
                        <div class="session-time" id="this-session-time">00:00</div>
                        <div class="session-label">å®é™…è¿åŠ¨æ—¶é•¿</div>
                    </div>
                    <div class="session-right">
                        <div class="session-steps" id="this-session-steps">0</div>
                        <div class="session-label">æœ¬æ¬¡æ­¥æ•°</div>
                    </div>
                </div>
                <div class="mini-stats">
                    <div class="mini-stat">
                        <div class="mini-value" id="sessions-count">6</div>
                        <div class="mini-label">æ€»æ¬¡æ•°</div>
                    </div>
                    <div class="mini-stat">
                        <div class="mini-value" id="total-duration">35:21</div>
                        <div class="mini-label">å®é™…è¿åŠ¨æ—¶é•¿</div>
                    </div>
                    <div class="mini-stat">
                        <div class="mini-value" id="step-count">6807</div>
                        <div class="mini-label">æ€»æ­¥æ•°</div>
                    </div>
                    <div class="mini-stat">
                        <div class="mini-value" id="avg-cadence">180</div>
                        <div class="mini-label">å¹³å‡BPM</div>
                    </div>
                </div>
                <div class="recent-activities">
                    <h4 class="activities-title">æœ€è¿‘è®°å½•</h4>
                    <div class="activity-list" id="activity-list">
                        <div class="activity-item">
                            <div class="activity-time">ä»Šå¤© 08:34</div>
                            <div class="activity-duration">16:00</div>
                            <div class="activity-type">æ…¢è·‘ Â· ä¸­ç­‰å¼ºåº¦</div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">8æœˆ7æ—¥ 20:30</div>
                            <div class="activity-duration">16:27</div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">8æœˆ7æ—¥ 17:29</div>
                            <div class="activity-duration">6:14</div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">8æœˆ7æ—¥ 17:06</div>
                            <div class="activity-duration">5:52</div>
                            <div class="activity-type">æ…¢è·‘ Â· è½»åº¦æœ‰æ°§</div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-time">8æœˆ7æ—¥ 12:31</div>
                            <div class="activity-duration">6:14</div>
                            <div class="activity-type">æ…¢è·‘ Â· ä¸­ç­‰å¼ºåº¦</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨ä¿¡æ¯ -->
        <div class="app-footer">
            <p>è¶…æ…¢è·‘ - è®©å¥åº·è¿åŠ¨æˆä¸ºç”Ÿæ´»ä¹ æƒ¯</p>
        </div>
    </div>

    <!-- è¿åŠ¨è¿›è¡Œä¸­çš„å…¨å±è¦†ç›–å±‚ -->
    <div class="exercise-overlay" id="exercise-overlay" style="display: none;">
        <div class="exercise-container">
            <div class="exercise-header">
                <h2>è¿åŠ¨è¿›è¡Œä¸­</h2>
                <button class="close-btn" id="close-exercise">Ã—</button>
            </div>
            <div class="exercise-timer">
                <div class="timer-circle">
                    <div class="timer-display" id="exercise-timer-display">15:00</div>
                    <div class="timer-label">å‰©ä½™æ—¶é—´</div>
                </div>
            </div>
            <div class="exercise-info">
                <div class="info-row">
                    <div class="info-item">
                        <span class="info-label">å½“å‰æ­¥é¢‘</span>
                        <span class="info-value" id="current-cadence">180</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å·²ç”¨æ—¶é—´</span>
                        <span class="info-value" id="elapsed-time">00:00</span>
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-item">
                        <span class="info-label">é¢„è®¡æ­¥æ•°</span>
                        <span class="info-value" id="estimated-steps">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ¶ˆè€—çƒ­é‡</span>
                        <span class="info-value" id="burned-calories">0</span>
                    </div>
                </div>
            </div>
            <div class="exercise-controls">
                <button class="control-btn pause-btn" id="pause-exercise">æš‚åœ</button>
                <button class="control-btn stop-btn" id="stop-exercise">ç»“æŸè¿åŠ¨</button>
            </div>
        </div>
    </div>

    <script>
        // è¶…æ…¢è·‘åŠ©æ‰‹ - å†…è”ç‰ˆæœ¬é¿å…æ¨¡å—å†²çª
        class SuperSlowRunCore {
            constructor() {
                this.config = {
                    defaultBPM: 190,
                    minBPM: 100,
                    maxBPM: 300,
                    defaultDuration: 15,
                    maxDuration: 999,
                    volumeDefault: 0.65
                };

                this.state = {
                    bpm: this.config.defaultBPM,
                    isMetronomeRunning: false,
                    isExerciseRunning: false,
                    exercisePaused: false,
                    currentDuration: this.config.defaultDuration,
                    elapsedTime: 0,
                    currentSound: 'click',
                    volume: this.config.volumeDefault,
                    metronomeAutoStarted: false
                };

                this.stats = {
                    totalSessions: 6,
                    totalTime: 35, // å…¼å®¹æ—§å­—æ®µï¼ˆåˆ†é’Ÿï¼‰
                    totalSeconds: 35 * 60,
                    totalSteps: 6738,
                    totalCalories: 2700,
                    averageBPM: 180,
                    weeklyTarget: 27 * 60,
                    todayTime: 16 * 60, // ç§’
                    recentActivities: []
                };

                this.timers = {
                    metronome: null,
                    exercise: null,
                    stats: null
                };

                this.audioContext = null;
                this.audioBuffer = null;
                this.initAudio();
                this.loadData();
            }

            async initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.soundConfigs = {
                        beep: { frequency: 800, duration: 0.1, wave: 'sine' },
                        tick: { frequency: 1000, duration: 0.05, wave: 'square' },
                        click: { frequency: 1200, duration: 0.08, wave: 'triangle' },
                        bell: { frequency: 600, duration: 0.2, wave: 'sine' },
                        drum: { frequency: 100, duration: 0.15, wave: 'sawtooth' }
                    };
                } catch (error) {
                    console.warn('éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:', error);
                }
            }

            playMetronomeSound() {
                if (!this.audioContext || this.state.volume === 0) return;
                try {
                    const config = this.soundConfigs[this.state.currentSound] || this.soundConfigs.click;
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    oscillator.frequency.setValueAtTime(config.frequency, this.audioContext.currentTime);
                    oscillator.type = config.wave;
                    gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(this.state.volume, this.audioContext.currentTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + config.duration);
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + config.duration);
                } catch (error) {
                    console.warn('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', error);
                }
            }

            startMetronome() {
                if (this.state.isMetronomeRunning) return;
                if (this.audioContext && this.audioContext.state === 'suspended') {
                    this.audioContext.resume();
                }
                this.state.isMetronomeRunning = true;
                const interval = 60000 / this.state.bpm;
                this.timers.metronome = setInterval(() => {
                    if (this.state.isMetronomeRunning) {
                        this.playMetronomeSound();
                        this.triggerMetronomeVisual();
                    }
                }, interval);
                console.log(`èŠ‚æ‹å™¨å·²å¯åŠ¨ - BPM: ${this.state.bpm}`);
            }

            stopMetronome() {
                this.state.isMetronomeRunning = false;
                if (this.timers.metronome) {
                    clearInterval(this.timers.metronome);
                    this.timers.metronome = null;
                }
                console.log('èŠ‚æ‹å™¨å·²åœæ­¢');
            }

            triggerMetronomeVisual() {
                const circle = document.getElementById('metronome-circle');
                if (circle) {
                    circle.classList.add('active');
                    setTimeout(() => circle.classList.remove('active'), 100);
                }
            }

            setBPM(newBPM) {
                newBPM = Math.max(this.config.minBPM, Math.min(this.config.maxBPM, parseInt(newBPM)));
                this.state.bpm = newBPM;
                if (this.state.isMetronomeRunning) {
                    this.stopMetronome();
                    this.startMetronome();
                }
                this.updateBPMDisplay();
                this.saveData();
                console.log(`BPMå·²è®¾ç½®ä¸º: ${newBPM}`);
            }

            updateBPMDisplay() {
                const elements = ['bpm-value', 'metronome-bpm', 'current-cadence'];
                elements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = this.state.bpm;
                });
                const statusElement = document.getElementById('bpm-status');
                if (statusElement) {
                    if (this.state.bpm <= 175) statusElement.textContent = 'è½»åº¦å¼ºåº¦';
                    else if (this.state.bpm <= 185) statusElement.textContent = 'ä¸­ç­‰å¼ºåº¦';
                    else statusElement.textContent = 'é«˜ç­‰å¼ºåº¦';
                }
            }

            updateStatsDisplay() {
                const todayElement = document.getElementById('today-time');
                if (todayElement) {
                    const tsec = Math.max(0, this.stats.todayTime || 0);
                    const minutes = Math.floor(tsec / 60);
                    const seconds = tsec % 60;
                    todayElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
                const caloriesElement = document.getElementById('total-calories');
                if (caloriesElement) caloriesElement.textContent = Math.floor(this.stats.totalCalories).toString();
                const totalSec = (this.stats.totalSeconds != null) ? this.stats.totalSeconds : Math.round((this.stats.totalTime || 0) * 60);
                const statsElements = {
                    'sessions-count': this.stats.totalSessions,
                    'total-duration': this.formatDuration(totalSec),
                    'step-count': this.stats.totalSteps,
                    'avg-cadence': this.stats.averageBPM
                };
                Object.entries(statsElements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = value.toString();
                });
                this.renderRecentActivities();
            }

            renderRecentActivities() {
                const list = document.getElementById('activity-list');
                if (!list) return;
                const records = (this.stats.recentActivities || []).slice(0, 5);
                if (!records.length) return; // è‹¥æ— è®°å½•ï¼Œä¿ç•™åŸå§‹ç¤ºä¾‹
                list.innerHTML = records.map(r => {
                    const d = new Date(r.ts || Date.now());
                    const month = d.getMonth() + 1;
                    const day = d.getDate();
                    const hh = String(d.getHours()).padStart(2, '0');
                    const mm = String(d.getMinutes()).padStart(2, '0');
                    const duration = this.formatSeconds ? this.formatSeconds(r.durationSec || 0) : `${Math.floor((r.durationSec||0)/60)}:${String((r.durationSec||0)%60).padStart(2,'0')}`;
                    const bpm = r.bpm || this.state.bpm;
                    return `
                        <div class="activity-item">
                            <div class="activity-time">${month}æœˆ${day}æ—¥ ${hh}:${mm}</div>
                            <div class="activity-duration">${duration}</div>
                            <div class="activity-type">${bpm} BPM Â· ${r.steps||0}æ­¥ Â· å¡è·¯é‡Œ ${r.calories||0}</div>
                        </div>
                    `;
                }).join('');
            }

            formatTime(minutes) {
                if (minutes < 60) return `${minutes}:00`;
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                return `${hours}:${mins.toString().padStart(2, '0')}`;
            }

            formatDuration(seconds) {
                const sec = Math.max(0, Math.round(seconds));
                if (sec < 3600) {
                    const m = Math.floor(sec / 60);
                    const s = sec % 60;
                    return `${m}:${s.toString().padStart(2, '0')}`;
                }
                const h = Math.floor(sec / 3600);
                const m = Math.floor((sec % 3600) / 60);
                return `${h}:${m.toString().padStart(2, '0')}`;
            }

            saveData() {
                try {
                    const data = { state: this.state, stats: this.stats, timestamp: Date.now() };
                    localStorage.setItem('superslowrun_data', JSON.stringify(data));
                } catch (error) {
                    console.warn('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                }
            }

            loadData() {
                try {
                    const saved = localStorage.getItem('superslowrun_data');
                    if (saved) {
                        const data = JSON.parse(saved);
                        if (data.state) {
                            Object.assign(this.state, data.state);
                            this.state.isMetronomeRunning = false;
                            this.state.isExerciseRunning = false;
                        }
                        if (data.stats) Object.assign(this.stats, data.stats);
                    }
                } catch (error) {
                    console.warn('åŠ è½½æ•°æ®å¤±è´¥:', error);
                }
            }
        }

        class SuperSlowRunApp {
            constructor() {
                this.core = new SuperSlowRunCore();
                this.init();
            }

            init() {
                console.log('ğŸƒâ€â™‚ï¸ è¶…æ…¢è·‘åŠ©æ‰‹åº”ç”¨åˆå§‹åŒ–ä¸­...');
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => this.onDOMReady());
                } else {
                    this.onDOMReady();
                }
            }

            onDOMReady() {
                this.bindEvents();
                this.updateAllDisplays();
                this.startPageAnimations();
                console.log('âœ… è¶…æ…¢è·‘åŠ©æ‰‹åº”ç”¨åˆå§‹åŒ–å®Œæˆ');
            }

            bindEvents() {
                // BPMæ§åˆ¶äº‹ä»¶
                const decreaseBtn = document.getElementById('bpm-decrease');
                const increaseBtn = document.getElementById('bpm-increase');
                if (decreaseBtn) {
                    decreaseBtn.addEventListener('click', () => {
                        const newBPM = this.core.state.bpm - 5;
                        this.core.setBPM(newBPM);
                        this.updateBPMInput();
                        this.updatePresetItems();
                        this.updatePresetButtons();
                    });
                }
                if (increaseBtn) {
                    increaseBtn.addEventListener('click', () => {
                        const newBPM = this.core.state.bpm + 5;
                        this.core.setBPM(newBPM);
                        this.updateBPMInput();
                        this.updatePresetItems();
                        this.updatePresetButtons();
                    });
                }

                // BPMé¢„è®¾æŒ‰é’® (æ—§çš„)
                document.querySelectorAll('.preset-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const bpm = parseInt(btn.dataset.bpm);
                        if (Number.isFinite(bpm)) {
                            this.core.setBPM(bpm);
                            const input = document.getElementById('custom-bpm');
                            if (input) input.value = String(this.core.state.bpm);
                            this.updatePresetButtons();
                        }
                    });
                });
                
                // æ–°çš„BPMé¢„è®¾æŒ‰é’®
                document.querySelectorAll('.preset-item').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const bpm = parseInt(btn.dataset.bpm);
                        if (Number.isFinite(bpm)) {
                            this.core.setBPM(bpm);
                            this.updateBPMInput();
                            this.updatePresetItems();
                        }
                    });
                });

                // BPMè¾“å…¥æ¡†å¤„ç†
                const bpmInput = document.getElementById('bpm-input');
                if (bpmInput) {
                    const onBpmInput = () => {
                        let v = parseInt(bpmInput.value || '0');
                        if (!Number.isFinite(v) || v < this.core.config.minBPM) {
                            v = this.core.config.minBPM;
                        } else if (v > this.core.config.maxBPM) {
                            v = this.core.config.maxBPM;
                        }
                        this.core.setBPM(v);
                        bpmInput.value = String(this.core.state.bpm);
                        this.updatePresetButtons();
                    };
                    
                    bpmInput.addEventListener('input', (e) => {
                        // å®æ—¶æ›´æ–°ä½†ä¸å¼ºåˆ¶é™åˆ¶
                        let v = parseInt(e.target.value || '0');
                        if (Number.isFinite(v)) {
                            this.core.state.bpm = Math.max(this.core.config.minBPM, Math.min(this.core.config.maxBPM, v));
                            this.updateBPMDisplays();
                            this.updatePresetItems();
                            this.updatePresetButtons();
                        }
                    });
                    
                    bpmInput.addEventListener('change', onBpmInput);
                    bpmInput.addEventListener('blur', onBpmInput);
                    bpmInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            onBpmInput();
                        }
                    });
                    
                    // è®¾ç½®åˆå§‹å€¼
                    bpmInput.value = String(this.core.state.bpm);
                }

                // èŠ‚æ‹å™¨æ’­æ”¾æŒ‰é’®
                const toggleBtn = document.getElementById('metronome-toggle');
                if (toggleBtn) {
                    toggleBtn.addEventListener('click', () => {
                        this.toggleMetronome();
                    });
                }

                // éŸ³é‡æ»‘å—
                const volumeSlider = document.getElementById('volume-slider');
                const volumePercent = document.getElementById('volume-percent');
                if (volumeSlider) {
                    volumeSlider.addEventListener('input', (e) => {
                        const volume = parseFloat(e.target.value) / 100;
                        this.core.state.volume = volume;
                        if (volumePercent) volumePercent.textContent = `${Math.round(volume * 100)}%`;
                    });
                    volumeSlider.value = this.core.state.volume * 100;
                    if (volumePercent) volumePercent.textContent = `${Math.round(this.core.state.volume * 100)}%`;
                }

                // éŸ³æ•ˆé€‰æ‹©æŒ‰é’®
                document.querySelectorAll('.sound-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const soundType = btn.dataset.sound;
                        if (soundType && this.core.soundConfigs[soundType]) {
                            this.core.state.currentSound = soundType;
                            this.updateSoundButtons();
                            const badge = document.querySelector('.badge.green');
                            if (badge) badge.textContent = `å½“å‰éŸ³æ•ˆ: ${btn.textContent.trim()}`;
                            this.core.playMetronomeSound();
                        }
                    });
                });

                // è®¡æ—¶å™¨é¢„è®¾
                document.querySelectorAll('.time-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const mins = parseInt(btn.dataset.time);
                        if (mins) {
                            this.core.state.currentDuration = mins;
                            const input = document.getElementById('custom-minutes');
                            if (input) input.value = String(mins);
                            this.updateTimeButtons();
                        }
                    });
                });

                // è‡ªå®šä¹‰æ—¶é—´è¾“å…¥
                const customInput = document.getElementById('custom-minutes');
                if (customInput) {
                    const onInput = () => {
                        let v = parseInt(customInput.value || '0');
                        if (!Number.isFinite(v)) v = this.core.config.defaultDuration;
                        v = Math.max(1, Math.min(this.core.config.maxDuration, v));
                        this.core.state.currentDuration = v;
                        this.updateTimeButtons();
                    };
                    customInput.addEventListener('input', onInput);
                    customInput.addEventListener('change', onInput);
                }

                // å¼€å§‹/æš‚åœ/ç»“æŸ/å…³é—­
                const startBtn = document.getElementById('start-exercise');
                if (startBtn) startBtn.addEventListener('click', () => this.startExercise());
                const pauseBtn = document.getElementById('pause-exercise');
                if (pauseBtn) pauseBtn.addEventListener('click', () => this.pauseExercise());
                const stopBtn = document.getElementById('stop-exercise');
                if (stopBtn) stopBtn.addEventListener('click', () => this.stopExercise(true));
                const closeBtn = document.getElementById('close-exercise');
                if (closeBtn) closeBtn.addEventListener('click', () => this.stopExercise(false));

                // ç©ºæ ¼é”®æ§åˆ¶èŠ‚æ‹å™¨
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && !e.target.matches('input')) {
                        e.preventDefault();
                        this.toggleMetronome();
                    }
                });
            }

            toggleMetronome() {
                if (this.core.state.isMetronomeRunning) {
                    this.core.stopMetronome();
                } else {
                    this.core.startMetronome();
                }
                this.updateMetronomeUI();
            }

            updateAllDisplays() {
                this.core.updateBPMDisplay();
                this.core.updateStatsDisplay();
                this.updateMetronomeUI();
                this.updatePresetButtons();
                this.updateSoundButtons();
                this.updateTimeButtons();
                this.updateExerciseUI();
            }

            updateMetronomeUI() {
                const toggleBtn = document.getElementById('metronome-toggle');
                const statusElement = document.getElementById('metronome-status');
                const playButton = document.querySelector('.play-button');
                
                if (this.core.state.isMetronomeRunning) {
                    if (toggleBtn) toggleBtn.textContent = 'â¸';
                    if (playButton) {
                        playButton.classList.add('playing');
                        playButton.innerHTML = '<span class="play-icon">â¸</span>';
                    }
                    if (statusElement) statusElement.textContent = 'æ­£åœ¨æ’­æ”¾';
                } else {
                    if (toggleBtn) toggleBtn.textContent = 'â–¶';
                    if (playButton) {
                        playButton.classList.remove('playing');
                        playButton.innerHTML = '<span class="play-icon">â–¶</span>';
                    }
                    if (statusElement) statusElement.textContent = 'ç‚¹å‡»æ’­æ”¾';
                }
            }

            updateBPMDisplays() {
                // æ›´æ–°æ‰€æœ‰BPMæ˜¾ç¤ºå…ƒç´ ï¼ŒåŒ…æ‹¬è¾“å…¥æ¡†
                const bpmInput = document.getElementById('bpm-input');
                if (bpmInput && bpmInput !== document.activeElement) {
                    bpmInput.value = String(this.core.state.bpm);
                }
                
                // æ›´æ–°å…¶ä»–BPMæ˜¾ç¤ºå…ƒç´ 
                this.core.updateBPMDisplay();
            }

            updateBPMInput() {
                const bpmInput = document.getElementById('bpm-input');
                if (bpmInput && bpmInput !== document.activeElement) {
                    bpmInput.value = String(this.core.state.bpm);
                }
            }
            
            updatePresetItems() {
                document.querySelectorAll('.preset-item').forEach(btn => {
                    const bpm = parseInt(btn.dataset.bpm);
                    if (bpm === this.core.state.bpm) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }

            updatePresetButtons() {
                document.querySelectorAll('.preset-btn').forEach(btn => {
                    const bpm = parseInt(btn.dataset.bpm);
                    if (bpm === this.core.state.bpm) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }

            updateSoundButtons() {
                document.querySelectorAll('.sound-btn').forEach(btn => {
                    const sound = btn.dataset.sound;
                    if (sound === this.core.state.currentSound) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }

            startPageAnimations() {
                const cards = document.querySelectorAll('.module-card');
                cards.forEach((card, index) => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, index * 150);
                });
            }

            // ============ è®¡æ—¶å™¨ä¸è¿åŠ¨é€»è¾‘ ============
            updateTimeButtons() {
                const mins = this.core.state.currentDuration;
                document.querySelectorAll('.time-btn').forEach(b => {
                    const v = parseInt(b.dataset.time);
                    if (v === mins) b.classList.add('active'); else b.classList.remove('active');
                });
            }

            startExercise() {
                if (this.core.state.isExerciseRunning) return;
                this.core.state.isExerciseRunning = true;
                this.core.state.exercisePaused = false;
                this.core.state.elapsedTime = 0;
                const overlay = document.getElementById('exercise-overlay');
                if (overlay) overlay.style.display = 'flex';
                // è‡ªåŠ¨å¯åŠ¨èŠ‚æ‹å™¨ï¼ˆè‹¥å½“å‰æœªè¿è¡Œï¼‰ï¼Œç”¨äºè¿åŠ¨ä¸­å‘å£°
                if (!this.core.state.isMetronomeRunning) {
                    this.core.state.metronomeAutoStarted = true;
                    this.core.startMetronome();
                } else {
                    this.core.state.metronomeAutoStarted = false;
                }
                this.updateExerciseUI();
                this.core.timers.exercise = setInterval(() => {
                    if (!this.core.state.isExerciseRunning || this.core.state.exercisePaused) return;
                    this.core.state.elapsedTime += 1;
                    const durationSec = this.core.state.currentDuration * 60;
                    if (this.core.state.elapsedTime >= durationSec) {
                        this.stopExercise(true);
                        return;
                    }
                    this.updateExerciseUI();
                }, 1000);
            }

            pauseExercise() {
                if (!this.core.state.isExerciseRunning) return;
                this.core.state.exercisePaused = !this.core.state.exercisePaused;
                const pauseBtn = document.getElementById('pause-exercise');
                if (pauseBtn) pauseBtn.textContent = this.core.state.exercisePaused ? 'ç»§ç»­' : 'æš‚åœ';
                // æš‚åœæ—¶å¦‚æœæ˜¯è‡ªåŠ¨å¯åŠ¨çš„èŠ‚æ‹å™¨åˆ™åœæ­¢ï¼Œç»§ç»­æ—¶å†æ¢å¤
                if (this.core.state.metronomeAutoStarted) {
                    if (this.core.state.exercisePaused) this.core.stopMetronome();
                    else this.core.startMetronome();
                }
            }

            stopExercise(saveStats) {
                if (this.core.timers.exercise) {
                    clearInterval(this.core.timers.exercise);
                    this.core.timers.exercise = null;
                }
                const overlay = document.getElementById('exercise-overlay');
                if (overlay) overlay.style.display = 'none';

                // è‹¥è¿åŠ¨æœŸé—´æˆ‘ä»¬è‡ªåŠ¨å¯åŠ¨äº†èŠ‚æ‹å™¨ï¼Œåˆ™åœ¨ç»“æŸæ—¶åœæ­¢
                if (this.core.state.metronomeAutoStarted) {
                    this.core.stopMetronome();
                    this.core.state.metronomeAutoStarted = false;
                }

                if (saveStats) {
                    const actualSeconds = this.core.state.elapsedTime; // å®é™…è¿åŠ¨æ—¶é•¿
                    const steps = Math.round((this.core.state.bpm / 60) * actualSeconds);
                    const calories = Math.round((actualSeconds / 60) * 3);
                    this.core.stats.totalSessions += 1;
                    this.core.stats.totalSeconds = (this.core.stats.totalSeconds || 0) + actualSeconds;
                    this.core.stats.totalTime = Math.round(this.core.stats.totalSeconds / 60); // å…¼å®¹æ—§å­—æ®µ
                    this.core.stats.todayTime = (this.core.stats.todayTime || 0) + actualSeconds;
                    this.core.stats.totalSteps += steps;
                    this.core.stats.totalCalories += calories;
                    // æœ€è¿‘è®°å½•ï¼ˆä¿ç•™5æ¡ï¼‰
                    this.core.stats.recentActivities = this.core.stats.recentActivities || [];
                    this.core.stats.recentActivities.unshift({
                        ts: Date.now(),
                        durationSec: actualSeconds,
                        bpm: this.core.state.bpm,
                        steps,
                        calories
                    });
                    this.core.stats.recentActivities = this.core.stats.recentActivities.slice(0, 5);
                    this.core.updateStatsDisplay();
                    this.core.saveData();
                }
                this.core.state.isExerciseRunning = false;
                this.core.state.exercisePaused = false;
                this.core.state.elapsedTime = 0;
                this.updateExerciseUI();
            }

            updateExerciseUI() {
                const durationSec = this.core.state.currentDuration * 60;
                const remain = Math.max(0, durationSec - this.core.state.elapsedTime);
                const display = document.getElementById('exercise-timer-display');
                if (display) display.textContent = this.formatSeconds(remain);
                const elapsedEl = document.getElementById('elapsed-time');
                if (elapsedEl) elapsedEl.textContent = this.formatSeconds(this.core.state.elapsedTime);
                const stepsEl = document.getElementById('estimated-steps');
                if (stepsEl) stepsEl.textContent = String(Math.round((this.core.state.bpm / 60) * this.core.state.elapsedTime));
                const calEl = document.getElementById('burned-calories');
                if (calEl) calEl.textContent = String(Math.round(this.core.state.elapsedTime * 0.05));
                const singleBadge = document.querySelector('.badge.purple');
                if (singleBadge) singleBadge.textContent = `å•æ¬¡: ${this.formatSeconds(this.core.state.elapsedTime)}`;
            }

            formatSeconds(sec) {
                const m = Math.floor(sec / 60);
                const s = sec % 60;
                return `${m}:${s.toString().padStart(2, '0')}`;
            }
        }

        // å¯åŠ¨åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            new SuperSlowRunApp();
            console.log('ğŸ¯ è¶…æ…¢è·‘åŠ©æ‰‹åº”ç”¨å¯åŠ¨å®Œæˆ');
        });
    </script>
</body>
</html>
